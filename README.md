# tg-translation-bot

一种快速实现的多语种多路翻译器

## Roadmap

- [x] 支持文本模态的多语种翻译
- [x] 加入图文混合模态的多语种文本编辑场景（原内容提取 + 可选的语种输出翻译）
- [ ] 有效处理表格型图片输入
- [x] 流式响应

## Advanced

### 交互优化

- [x] 区分 `MENTION`, `REPLY`, `MENTION_WITH_REPLY` 三种直接交互方式
- [x] 通过仅输出 LLM 节点 `node_started` 信号以及 Agent 节点的 `thought` 信号来降低 flood 触发概率
- [ ] 有效处理即时通信场景中的碎片消息翻译问题，代入充足的上下文信息以复原完整的深层意图

### 意图分类器

- [x] 多层次：在 Chatflow 中添加 Node + Telegram Bot Command 的功能和模式分流

### 长期记忆

- [ ] 用户偏好、会话管理与长期记忆

    - 如何感知、记忆和回调用户偏好？

    - 当前场景更适合 Chatflow 还是 Workflow？如何应对用户对翻译结果的编辑要求？

**IF Workflow**

| ITEM | KNOW-HOW                                                     |
| ---- | ------------------------------------------------------------ |
| YES  | 极简设计，无需管理复杂的 OAI 多轮对话对象，所有 **文本模态** 历史操作记忆都可通过 Telegram API 获取并作为 user_prompt 的一部分单次请求 |
| BUT  | 机器人需要知道一定记忆窗口内的历史翻译记录（IN&OUT），否则无法应对碎片消息和二次编辑需求。如果不是 ALL 那必然设置一个窗口，如何设计这个窗口？ |

Optimization
-------------

### Baseline

- [ ] 提高响应速度
- [ ] 触发渠道优化
- [x] 白名单控制
- [ ] 适当的拒绝响应
- [ ] Ratelimit

### AFTER

- [ ] 记忆并持久化翻译偏好

  默认直接中英互译

- [ ] 开启自动监听模式（`/auto`）
   - [ ] 自动将模式下的非中文翻译成中文，如果目标语言不是英文，则自动翻译为英文 + 中文
   - [ ] **延迟消息队列**：应对即时通信场景下用户的“碎片消息”，当用户“熄火” 1 分钟内无新消息产生，再将一段时间窗口内的信息作为 context 翻译
   - [ ] 自动监听模式使用 “Quote” 来构建响应消息，而不是 reply 在 1 分钟后打扰用户
   - [ ] 过滤掉来自 “me” 的消息避免无限环回

- [ ] 
  3. 暂停自动监听模式（`/pause`）
     确保 re-start 后不处理过时消息

## FQA

### Telegram `parse_mode=HTML` 支持的标签列表

| 格式化名称                  | HTML 标签                                                  | 描述和说明                                                   |
| :-------------------------- | :--------------------------------------------------------- | :----------------------------------------------------------- |
| **加粗 (Bold)**             | `<b>...</b>` 或 `<strong>...</strong>`                     | 使文本变为粗体。两者效果相同。                               |
| **斜体 (Italic)**           | `<i>...</i>` 或 `<em>...</em>`                             | 使文本变为斜体。两者效果相同。                               |
| **下划线 (Underline)**      | `<u>...</u>` 或 `<ins>...</ins>`                           | 为文本添加下划线。                                           |
| **删除线 (Strikethrough)**  | `<s>...</s>` 或 `<strike>...</strike>` 或 `<del>...</del>` | 为文本添加删除线。                                           |
| **剧透 (Spoiler)**          | `<tg-spoiler>...</tg-spoiler>`                             | 隐藏部分文本，用户需要点击后才能查看。                       |
| **链接 (Link)**             | `<a href="URL">...</a>`                                    | 创建一个超链接。URL 必须是完整的，例如 `https://example.com`。 |
| **行内代码 (Inline Code)**  | `<code>...</code>`                                         | 以等宽字体显示一小段文本，通常用于代码变量、命令等。         |
| **代码块 (Code Block)**     | `<pre>...</pre>`                                           | 创建一个预格式化的多行代码块，保留所有空格和换行符，并以等宽字体显示。 |
| **带语法高亮的代码块**      | `<pre><code class="language-python">...</code></pre>`      | 在代码块的基础上增加语法高亮。`language-python` 可以替换为 `language-javascript`, `language-java` 等。 |
| **引用 (Quote/Blockquote)** | `<blockquote>...</blockquote>`                             | 创建一个引用块，通常带有垂直线标识。                         |

## Reference

https://docs.python-telegram-bot.org/en/stable/